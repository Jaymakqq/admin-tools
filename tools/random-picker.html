<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>éš¨æ©ŸæŠ½å–å™¨ - æ”¯æ´æª”æ¡ˆä¸Šå‚³</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');
        
        body {
            font-family: 'Inter', system-ui, -apple-system, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .picker-card {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }

        .winner-animation {
            animation: popIn 0.5s cubic-bezier(0.26, 0.53, 0.74, 1.48);
        }

        @keyframes popIn {
            0% { transform: scale(0.5); opacity: 0; }
            100% { transform: scale(1); opacity: 1; }
        }

        .rolling {
            animation: pulse 0.1s infinite;
        }

        @keyframes pulse {
            0% { transform: translateY(0); }
            50% { transform: translateY(-2px); }
            100% { transform: translateY(0); }
        }
    </style>
</head>
<body class="p-4 md:p-8">
    <div class="max-w-4xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-4xl font-extrabold text-gray-800 mb-2">ğŸ¯ éš¨æ©ŸæŠ½å–å™¨</h1>
            <p class="text-gray-600">ä¸Šå‚³åå–®æˆ–ç›´æ¥è²¼ä¸Šï¼Œä¸€éµæŠ½å‡ºå¹¸é‹å…’</p>
        </header>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
            <!-- å·¦å´ï¼šè¼¸å…¥å€åŸŸ -->
            <div class="picker-card p-6 space-y-6">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">1. ä¸Šå‚³åå–®æª”æ¡ˆ (.txt æˆ– .csv)</label>
                    <input type="file" id="fileInput" accept=".txt,.csv" class="block w-full text-sm text-gray-500 file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100 cursor-pointer"/>
                </div>

                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">2. æ‰‹å‹•è¼¸å…¥æˆ–ç·¨è¼¯åå–® (æ¯è¡Œä¸€å€‹åå­—)</label>
                    <textarea id="nameList" rows="10" class="w-full p-4 border border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-transparent outline-none transition" placeholder="ä¾‹å¦‚ï¼š&#10;é™³å°æ˜&#10;ç‹å¤§è¯&#10;æç¾ç²..."></textarea>
                    <p id="countDisplay" class="text-right text-xs text-gray-400 mt-1">ç›®å‰äººæ•¸: 0</p>
                </div>

                <div class="flex items-center space-x-2">
                    <input type="checkbox" id="removeWinner" class="w-4 h-4 text-blue-600 rounded">
                    <label for="removeWinner" class="text-sm text-gray-600 cursor-pointer">æŠ½å‡ºå¾Œå¾åå–®ç§»é™¤ (ä¸é‡è¤‡æŠ½å–)</label>
                </div>
            </div>

            <!-- å³å´ï¼šæŠ½å–å€åŸŸ -->
            <div class="flex flex-col space-y-6">
                <div class="picker-card p-6 flex-grow flex flex-col items-center justify-center text-center space-y-6">
                    <div id="displayArea" class="h-32 flex items-center justify-center">
                        <span id="resultDisplay" class="text-5xl md:text-6xl font-black text-blue-600">æº–å‚™å¥½äº†å—ï¼Ÿ</span>
                    </div>
                    
                    <button id="pickBtn" class="w-full py-4 bg-blue-600 hover:bg-blue-700 text-white text-xl font-bold rounded-2xl shadow-lg transform active:scale-95 transition-all">
                        ç«‹å³æŠ½å–
                    </button>
                    
                    <button id="resetBtn" class="text-sm text-gray-400 hover:text-red-500 transition-colors duration-200">
                        é‡è¨­æ­·å²ç´€éŒ„
                    </button>
                </div>

                <!-- ä¸­çæ­·å² -->
                <div class="picker-card p-6">
                    <h3 class="font-bold text-gray-700 mb-3 border-b pb-2">ğŸ† ä¸­çæ­·å²ç´€éŒ„</h3>
                    <div id="historyList" class="space-y-2 max-h-48 overflow-y-auto text-sm text-gray-600">
                        <p class="italic text-gray-400 text-center py-4">å°šç„¡ç´€éŒ„</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- æç¤ºæ¡†å®¹å™¨ -->
    <div id="toast" class="fixed bottom-10 left-1/2 transform -translate-x-1/2 bg-gray-800 text-white px-6 py-3 rounded-full shadow-2xl opacity-0 transition-opacity pointer-events-none z-50">
        æç¤ºè¨Šæ¯
    </div>

    <script>
        const fileInput = document.getElementById('fileInput');
        const nameListArea = document.getElementById('nameList');
        const countDisplay = document.getElementById('countDisplay');
        const resultDisplay = document.getElementById('resultDisplay');
        const pickBtn = document.getElementById('pickBtn');
        const resetBtn = document.getElementById('resetBtn');
        const historyList = document.getElementById('historyList');
        const removeWinnerCheck = document.getElementById('removeWinner');
        const toast = document.getElementById('toast');

        let isRolling = false;
        let winners = [];

        // é¡¯ç¤ºæç¤ºè¨Šæ¯
        function showToast(msg) {
            toast.innerText = msg;
            toast.classList.remove('opacity-0');
            setTimeout(() => toast.classList.add('opacity-0'), 2000);
        }

        // æ›´æ–°äººæ•¸é¡¯ç¤º
        function updateCount() {
            const names = getNames();
            countDisplay.innerText = `ç›®å‰äººæ•¸: ${names.length}`;
        }

        // ç²å–ç•¶å‰åå–®æ•¸çµ„
        function getNames() {
            return nameListArea.value.split('\n')
                .map(n => n.trim())
                .filter(n => n !== "");
        }

        // è™•ç†æª”æ¡ˆä¸Šå‚³
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = (event) => {
                const content = event.target.result;
                const processed = content.replace(/,/g, '\n');
                nameListArea.value = processed;
                updateCount();
                showToast("æª”æ¡ˆè¼‰å…¥æˆåŠŸï¼");
            };
            reader.readAsText(file);
        });

        // ç›£è½æ–‡å­—æ¡†è®ŠåŒ–
        nameListArea.addEventListener('input', updateCount);

        // æŠ½å–é‚è¼¯
        pickBtn.addEventListener('click', () => {
            if (isRolling) return;

            const names = getNames();
            if (names.length === 0) {
                showToast("è«‹å…ˆè¼¸å…¥åå–®æˆ–ä¸Šå‚³æª”æ¡ˆï¼");
                return;
            }

            isRolling = true;
            pickBtn.disabled = true;
            pickBtn.classList.add('opacity-50', 'cursor-not-allowed');
            
            resultDisplay.classList.add('rolling');
            resultDisplay.classList.remove('winner-animation');
            resultDisplay.classList.remove('text-blue-600');
            resultDisplay.classList.add('text-gray-400');

            const rollDuration = 2000; 
            const intervalTime = 80;

            const rollEffect = setInterval(() => {
                const tempIndex = Math.floor(Math.random() * names.length);
                resultDisplay.innerText = names[tempIndex];
            }, intervalTime);

            setTimeout(() => {
                clearInterval(rollEffect);
                
                const finalIndex = Math.floor(Math.random() * names.length);
                const winner = names[finalIndex];

                // é¡¯ç¤ºçµæœ
                resultDisplay.innerText = winner;
                resultDisplay.classList.remove('rolling');
                resultDisplay.classList.remove('text-gray-400');
                resultDisplay.classList.add('text-blue-600', 'winner-animation');

                // åŠ å…¥æ­·å²
                winners.unshift(winner);
                updateHistory();

                // åˆ¤æ–·æ˜¯å¦ç§»é™¤
                if (removeWinnerCheck.checked) {
                    const updatedNames = names.filter((_, idx) => idx !== finalIndex);
                    nameListArea.value = updatedNames.join('\n');
                    updateCount();
                }

                isRolling = false;
                pickBtn.disabled = false;
                pickBtn.classList.remove('opacity-50', 'cursor-not-allowed');
            }, rollDuration);
        });

        // æ›´æ–°æ­·å²ç´€éŒ„
        function updateHistory() {
            if (winners.length === 0) {
                historyList.innerHTML = '<p class="italic text-gray-400 text-center py-4">å°šç„¡ç´€éŒ„</p>';
                return;
            }
            historyList.innerHTML = winners.map((w, i) => `
                <div class="flex justify-between items-center bg-gray-50 p-2 rounded-lg border border-gray-100 winner-animation">
                    <span class="font-medium text-gray-700">${w}</span>
                    <span class="text-xs text-gray-400">#${winners.length - i}</span>
                </div>
            `).join('');
        }

        // é‡è¨­æŒ‰éˆ•é‚è¼¯ï¼šåƒ…é‡è¨­æ­·å²èˆ‡ç•¶å‰çµæœï¼Œä¿ç•™åå–®
        resetBtn.addEventListener('click', () => {
            if (winners.length > 0 || resultDisplay.innerText !== "æº–å‚™å¥½äº†å—ï¼Ÿ") {
                winners = [];
                resultDisplay.innerText = "æº–å‚™å¥½äº†å—ï¼Ÿ";
                resultDisplay.classList.remove('winner-animation', 'text-blue-600');
                resultDisplay.classList.add('text-gray-400');
                
                updateHistory();
                // ä¸æ¸…ç©º nameListArea.value
                showToast("ä¸­çç´€éŒ„å·²é‡è¨­ï¼Œåå–®å·²ä¿ç•™");
            } else {
                showToast("ç›®å‰æ²’æœ‰æ­·å²ç´€éŒ„");
            }
        });
    </script>
</body>
</html>
